import{jsx as l,jsxs as x}from"https://esm.sh/react/jsx-runtime";import{createRoot as re}from"https://esm.sh/react-dom/client";import{useEffect as ae,useRef as xe,useState as ke}from"https://esm.sh/react";import{unstableSetRender as Le,theme as je,Input as Te,Typography as v,notification as Ie,Flex as L,ConfigProvider as Pe,Tooltip as te,Radio as R,Checkbox as ne,Table as Ue,Spin as ze,Tag as C,Button as W,Alert as Oe}from"https://esm.sh/antd?standalone";import{GithubOutlined as _e,YoutubeOutlined as De,TwitterOutlined as Re,SunOutlined as Ce,MoonOutlined as We,DownloadOutlined as q}from"https://esm.sh/@ant-design/icons?standalone";import Me from"https://esm.sh/fuse.js?standalone";import{File as D,encode as H,Fmt as K,decode as O,guess as _}from"https://esm.sh/@easy-install/easy-archive?standalone";import{create as Ae}from"https://esm.sh/zustand?standalone";import{persist as Be,createJSONStorage as Ee}from"https://esm.sh/zustand?standalone/middleware";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))f(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&f(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function f(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const Ne="apng,avif,bmp,gif,j2k,jp2,jfif,jpeg,jpg,jxl,mj2,png,svg,tga,tif,tiff,webp".split(",");function qe(n,e){if(!n?.length)return!1;for(const t of e){if(t.length===0)return!n.includes(".");if(n.endsWith(`.${t}`))return!0}return!1}function Z(n,e=Ne){return qe(n.toLocaleLowerCase(),e)}function He(n,e,t){const f=new TextDecoder("utf-8"),i=f.decode(n),s="#".repeat(4),o=[s,t.name,s].join(" ");if(i.includes(o))return n;const a=f.decode(e).trim(),h=[i,"",o,a,o,""].join(`
`).trimStart();return new TextEncoder().encode(h)}function Ke(n){if(n.length===0)return 0;if(n.length===1)return n[0].length;let e=0;const t=n[0];for(let f=0;f<t.length;f++){const i=t[f];if(n.every(s=>s[f]===i))e++;else break}return e}function oe(n,e,t,f="portable_config"){for(const o of["fonts","script-opts","shaders"])if(e.find(a=>a.path.startsWith(`${o}/`))){const a=e.filter(h=>h.path.startsWith(`${o}/`));e=e.filter(h=>!h.path.startsWith(`${o}/`));for(const h of a)h.path=`${f}/${o}/${h.path.replace(`${o}/`,"")}`,n.push(h)}if(e.find(o=>o.path.startsWith("scripts/"))){const o=e.filter(d=>d.path.startsWith("scripts/"));e=e.filter(d=>!d.path.startsWith("scripts/"));const a=o.map(d=>d.path.split("/")).map(d=>d.slice(1,d.length-1)),h=Ke(a),g=`${(h?["scripts",...a[0].slice(0,h)]:["scripts"]).join("/")}/`,b=o.filter(d=>!d.path.replace(g,"").includes("/")&&d.path.endsWith(".lua")),S=o.filter(d=>!d.path.replace(g,"").includes("/")&&d.path.endsWith(".js"));b.length===1?b[0].path=`${t.scriptName||t.name}/main.lua`:S.length===1&&(S[0].path=`${t.scriptName||t.name}/main.js`);for(const d of o){const k=d.path.replace(g,`${t.scriptName||t.name}/`);d.path=`${f}/scripts/${k}`,n.push(d)}}if(e.find(o=>o.path.startsWith("externals/"))){const o=e.filter(a=>a.path.startsWith("externals/"));e=e.filter(a=>!a.path.startsWith("externals/"));for(const a of o)a.path=a.path.replace("externals/",""),n.push(a)}for(const o of["input.conf","mpv.conf"]){const a=e.findIndex(T=>T.path===o);if(a===-1)continue;const h=e.splice(a,1)[0],w=n.findIndex(T=>T.path===`${f}/${o}`);let g;w===-1?g=new D(`${f}/${o}`,new Uint8Array,void 0,!1,BigInt(Date.now())):g=n.splice(w,1)[0];const{path:b,mode:S,isDir:d,lastModified:k,buffer:A}=g,B=He(A,h.buffer,t);n.push(new D(b,B,S,d,k))}if(e.find(o=>!o.path.includes("/")&&o.path.endsWith(".conf"))){const o=e.filter(a=>!a.path.includes("/")&&a.path.endsWith(".conf"));e=e.filter(a=>!(!a.path.includes("/")&&a.path.endsWith(".conf")));for(const a of o){const h=e.find(b=>b.path===a.path.replace(".conf",".js")),w=e.find(b=>b.path===a.path.replace(".conf",".lua")),g=h||w?`${f}/script-opts/${a.path}`:a.path;a.path=g,n.push(a)}}if(e.find(o=>!o.path.includes("/")&&Z(o.path))){const o=e.filter(a=>!a.path.includes("/")&&Z(a.path));e=e.filter(a=>!(!a.path.includes("/")&&Z(a.path)));for(const a of o)a.path=`${f}/fonts/${a.path}`,n.push(a)}const i=e.filter(o=>!o.path.includes("/")&&o.path.endsWith(".lua")),s=e.filter(o=>!o.path.includes("/")&&o.path.endsWith(".js"));i.length===1?i[0].path="main.lua":s.length===1&&(s[0].path="main.js");for(const o of e)o.path=`${f}/scripts/${t.scriptName||t.name}/${o.path}`,n.push(o)}const Ze=[["thumbfast","mpv-easy-thumbfast"],["autoload","mpv-easy-autoload"],["uosc","mpv-easy","ModernX cyl0","ModernZ","mpv.net"]],se={uosc:["autoload","mpv-easy-autoload"],"mpv-easy":["mpv-easy-anime4k","mpv-easy-clipboard-play","mpv-easy-copy-time","mpv-easy-cut","mpv-easy-translate","mpv-easy-autoload","mpv-easy-copy-screen","mpv-easy-crop","mpv-easy-thumbfast"]};function Ge(n,e=Ze){for(const i of e){const s=[];for(const o of n)i.includes(o)&&s.push(o);if(s.length>1)return s}const t=new Set,f=new Set(n);for(const i in n){const s=se[i]||[];for(const o of s)f.has(o)&&(t.add(i),t.add(o))}return Array.from(t)}var Je=function(n){ae(n,[])},Xe=function(n){Je(function(){n()})};function Ve(n){try{const e=new URL(n);if(e.hostname!=="github.com")return;const t=e.pathname.split("/").filter(Boolean);return t.length<2?void 0:{user:t[0],repo:t[1]}}catch{return}}Le(function(n,e){e._reactRoot||(e._reactRoot=re(e));var t=e._reactRoot;return t.render(n),function(){return new Promise(function(f){setTimeout(function(){t.unmount(),f()},0)})}});const ie="https://cdn.jsdelivr.net";async function Ye(n){const e=await fetch(n).then(t=>t.arrayBuffer());return new Uint8Array(e)}async function Qe(n){const e=Fe(n);if(!e)return[];const t=/<a[^>]+href="([^"]+)"[^>]*>([^<]+)<\/a>/g,f=[];for(const i of Array.from(e.matchAll(t),([,s,o])=>{const a=s.endsWith("/");return{path:s.split("/").slice(4).join("/"),url:ie+s,name:o,isDir:a}}))i.isDir||(i.buffer=await Ye(i.url)),i.name!=="..."&&f.push(i);return f}function Fe(n){const e=/<table[^>]*>([\s\S]*?)<\/table>/i,t=n.match(e);return t?t[1].trim():null}async function ce(n,e,t){const f=await fetch(t).then(o=>o.text()),i=await Qe(f),s=[];for(const o of i)if(o.isDir){const a=t+o.path,h=await ce(n,e,a);for(const w of h)s.push(w)}else s.push(o);return s}function X(n,e){const t=ie+`/gh/${n}/${e}/`;return ce(n,e,t)}const{defaultAlgorithm:et,darkAlgorithm:tt}=je,{Search:nt}=Te,{Title:ot,Link:rt}=v,at={getItem:n=>{const t=new URLSearchParams(location.hash.slice(1)).get(n)??"";return JSON.parse(t)},setItem:(n,e)=>{const t=new URLSearchParams(location.hash.slice(1));t.set(n,JSON.stringify(e)),location.hash=t.toString()},removeItem:n=>{const e=new URLSearchParams(location.hash.slice(1));e.delete(n),location.hash=e.toString()}},st=["mpv","mpv-v3","mpv.net"],le={data:{},tableData:[],spinning:!1,selectedRowKeys:[],externalList:[],ui:"osc",platform:"mpv-v3",repos:[]},it=Ae()(Be((n,e)=>({...le,setData:t=>n({...e(),data:t}),setTableData:t=>n({...e(),tableData:t}),setSpinning:t=>n({...e(),spinning:t}),setSelectedKeys:t=>n({...e(),selectedRowKeys:t}),setExternalList:t=>n({...e(),externalList:t}),setUI:t=>n({...e(),ui:t}),setPlatform:t=>n({...e(),platform:t}),setState:t=>{n({...e(),...t})},setRepos:t=>n({...e(),repos:t})}),{name:"mpv-build",storage:Ee(()=>at),version:void 0,partialize:n=>Object.fromEntries(Object.entries(n).filter(([e])=>!["data","tableData","spinning"].includes(e)))})),G=150,J=150,ct=250;function M(n,e){const t=new Blob([new Uint8Array(e)],{type:"application/octet-stream"}),f=URL.createObjectURL(t),i=document.createElement("a"),s=n.split("/").at(-1)??n;i.download=s,i.href=f,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(f)}function lt(n,e,t,f){return`https://raw.githubusercontent.com/${n}/${e}/${t}/${f}`}function j(n){return lt("ahaoboy","mpv-easy-cdn","main",n)}function ft(){return j("mpv-easy-play-with-windows.zip")}function ut(){return j("yt-dlp.zip")}function pt(){return j("ffmpeg-windows.tar.xz")}function dt(){return j("ffmpeg-v3-windows.tar.xz")}const z=[{name:"osc",repo:"https://github.com/mpv-player/mpv",deps:["autoload","thumbfast"],requires:[]},{name:"uosc",repo:"https://github.com/tomasklaen/uosc",deps:["thumbfast"],requires:["uosc"]},{name:"mpv-easy",repo:"https://github.com/mpv-easy/mpv-easy",deps:[],requires:["mpv-easy"]},{name:"modernx",repo:"https://github.com/cyl0/ModernX",deps:["thumbfast","autoload"],requires:["ModernX cyl0"]},{name:"modernz",repo:"https://github.com/Samillion/ModernZ",deps:["thumbfast","autoload"],requires:["ModernZ"]}],ht=["ffmpeg","yt-dlp","play-with"];async function P(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>new Uint8Array(e))}function fe(n){return j(`${n}.zip`)}async function mt(n){if(n.repo)return(await X(n.repo.user,n.repo.repo)).filter(o=>!o.isDir).map(({path:o,buffer:a})=>new D(o,a,void 0,!1,null));const{download:e}=n;if(![".js",".lua",".zip"].some(s=>e.endsWith(s)))return console.log("not support script: ",n),[];const t=fe(n.name),f=await P(t);return O(_(t),f).filter(s=>!s.isDir)}async function yt(n,e){let t=j("mpv-windows.tar.xz");n==="mpv.net"&&(t=j("mpv.net.tar.xz"));const f=await P(t);return O(_(t),f)||[]}function gt(){const n=it(),e=xe(null),{data:t,tableData:f,spinning:i,selectedRowKeys:s,externalList:o,ui:a,setData:h,setTableData:w,setSpinning:g,setUI:b,setSelectedKeys:S,setExternalList:d,platform:k,setPlatform:A,setState:B,repos:T,setRepos:ue}=n,V=a==="mpv-easy"?"mpv-easy":`mpv-${a}`,[E,Y]=ke(window.matchMedia("(prefers-color-scheme: dark)").matches),N=z.find(r=>r.name===a)?.requires||[],[wt,pe]=Ie.useNotification(),de=()=>{B({...le,data:t,tableData:f})},he=[...s,...z.find(r=>r.name===a)?.requires||[]],Q=async r=>{for(const c of he){const p=t[c];if(p.repo){const{user:m,repo:u}=p.repo,$=(await X(m,u)).filter(U=>!U.isDir).map(({path:U,buffer:$e})=>new D(U,$e,void 0,!1,null)),I=`${m}-${u}`;oe(r,$,t[I])}else{const m=await mt(t[c]);oe(r,m,t[c])}}},me=async()=>{const r=[];await Q(r);for(const p of r)p.path=p.path.replace("portable_config/","");const c=H(K.Zip,r);if(!c){console.log("zip file error");return}return c},ye=async()=>{const r=await yt(k);if(o.includes("ffmpeg")){const p=k==="mpv-v3"?dt():pt(),m=await P(p),u=O(_(p),m);for(const y of u)r.push(y)}if(o.includes("yt-dlp")){const p=ut(),m=await P(p),u=O(_(p),m);for(const y of u)r.push(y)}if(o.includes("play-with")){const p=ft(),m=await P(p),u=O(_(p),m);for(const y of u)r.push(y)}Q(r);const c=H(K.Zip,r);if(!c){console.log("zip file error");return}return c},ge=async()=>{g(!0),await new Promise(c=>setTimeout(c));const r=await ye();g(!1),r&&M(`${V}.zip`,r)},we=async()=>{g(!0),await new Promise(c=>setTimeout(c));const r=await me();g(!1),r&&M("portable_config.zip",r)},F=async()=>{const r=j("scripts-full.json"),c=await fetch(r).then(u=>u.text()).then(u=>JSON.parse(u));for(const u in c)c[u].key=u;for(const{user:u,repo:y}of T){const $=`${u}-${y}`,I=`https://github.com/${u}/${y}`,U={key:$,name:$,download:$,author:u,description:I,homepage:I,repo:{user:u,repo:y}};c[$]=U}h(c);const p=s.map(u=>c[u]),m=Object.values(c).sort(()=>.5-Math.random()).filter(u=>!s.includes(u.name));w([...p,...m]),e.current=new Me(Object.values(c),{keys:["name"]})};Xe(F),ae(()=>{F()},[T]);const ve=[{title:"name",dataIndex:"name",key:"key",render:(r,c)=>l(rt,{href:c.homepage,target:"_blank",rel:"noreferrer",children:c.name}),width:ct},{title:"description",dataIndex:"description",key:"key"},{title:"author",dataIndex:"author",key:"url"},{title:"download",dataIndex:"download",key:"url",render:(r,c)=>l(W,{icon:l(q,{}),onClick:async()=>{if(c.repo){const u=(await X(c.repo.user,c.repo.repo)).filter($=>!$.isDir).map(({path:$,buffer:I})=>new D($,I,void 0,!1,null)),y=H(K.Zip,u);y&&M(`${c.repo.repo}.zip`,y);return}const p=await P(fe(c.name));M(`${c.name}.zip`,p)}},c.download)}],be=(r,c,p)=>{const m=Ve(r);if(m){S([...new Set([...s,`${m.user}-${m.repo}`])]),ue([...new Set([...T,m])]);return}const u=e.current?.search(r);u?.length&&w(u.map(y=>y.item))};if(!Object.keys(t).length)return l(L,{className:"main",vertical:!0,gap:"middle",justify:"center",align:"center",children:l(v,{children:l(ot,{level:3,children:"Loading..."})})});const ee=Ge([...s,...z.find(r=>r.name===a)?.requires||[]]),Se=se[a]||[];return x(Pe,{theme:{algorithm:E?tt:et},children:[pe,x(L,{className:["main",E?"main-dark":"main-light"].join(" "),vertical:!0,gap:"middle",justify:"center",align:"center",children:[x(L,{gap:"middle",justify:"center",align:"center",style:{position:"absolute",top:"1rem",right:"1rem"},children:[l(v.Link,{href:"https://github.com/mpv-easy/mpv-easy",target:"_blank",children:l(_e,{})}),l(v.Link,{href:"https://www.youtube.com/@mpveasy",target:"_blank",children:l(De,{})}),l(v.Link,{href:"https://x.com/mpv_easy",target:"_blank",children:l(Re,{})}),E?l(v.Link,{onClick:()=>Y(!1),children:l(Ce,{})}):l(v.Link,{onClick:()=>Y(!0),children:l(We,{})})]}),x(L,{gap:"middle",vertical:!0,align:"start",children:[x(L,{gap:"middle",justify:"center",align:"center",children:[l(v.Title,{level:5,style:{margin:0,width:G},children:l(te,{title:"mpv-v3 is for newer CPUs (usually after 2005). If it doesn't run, please use mpv",children:"Platform:"})}),l(R.Group,{value:k,onChange:r=>{A(r.target.value)},children:st.map(r=>l(te,{placement:"topLeft",title:r==="mpv"?"Typically, you should use mpv-v3 unless it fails to run or you're using an older CPU (manufactured around 2015 or earlier).":"",children:l(R,{value:r,style:{width:J},children:r},r)},r))})]}),x(L,{gap:"middle",justify:"center",align:"center",children:[l(v.Title,{level:5,style:{margin:0,width:G},children:"UI:"}),l(R.Group,{onChange:r=>{b(r.target.value);const c=z.find(p=>p.name===r.target.value)?.deps||[];S([...c])},value:a,children:z.map(r=>l(R,{value:r.name,style:{width:J},children:l(v.Link,{href:r.repo,target:"_blank",children:r.name})},r.name))})]}),x(L,{gap:"middle",justify:"center",align:"center",children:[l(v.Title,{level:5,style:{margin:0,width:G},children:"External:"}),l(ne.Group,{value:o,onChange:r=>{d(r)},children:ht.map(r=>l(ne,{value:r,style:{width:J},children:r},r))})]})]}),l(nt,{placeholder:"input script name or https://github.com/<user>/<repo>",onSearch:be,enterButton:!0}),l(Ue,{rowSelection:{hideSelectAll:!0,type:"checkbox",onSelect:(r,c)=>{S(c?[...s,r.name]:[...s].filter(p=>p!==r.name))},getCheckboxProps:r=>({disabled:N.includes(r.name)||Se.includes(r.name),name:r.name}),selectedRowKeys:[...s,...N]},className:"table",columns:ve,dataSource:f}),l(ze,{spinning:i,fullscreen:!0}),x(L,{children:[l(C,{color:"processing",children:k},k),N.map((r,c)=>t[r]&&l(C,{color:"success",children:t[r]?.name},t[r]?.key+c)),o.map(r=>l(C,{color:"success",children:r},r)),s.map((r,c)=>l(C,{closable:!0,color:"success",onClose:p=>{const m=s.indexOf(t[r]?.key);if(m!==-1){const u=[...s];u.splice(m,1),S(u)}p.preventDefault()},children:t[r]?.name},t[r]?.key+c))]}),x(L,{gap:"middle",children:[l(W,{color:"danger",size:"large",variant:"solid",onClick:de,children:"Reset"}),x(W,{type:"primary",icon:l(q,{}),size:"large",onClick:ge,children:[V,".zip"]}),l(W,{type:"primary",icon:l(q,{}),size:"large",onClick:we,children:"portable_config.zip"})]}),!!ee.length&&l(Oe,{description:`conflict: ${ee.join(" ")}`,type:"error"})]})]})}re(document.getElementById("root")).render(l(gt,{}));
