import{jsx as u,jsxs as _}from"https://esm.sh/react/jsx-runtime";import{createRoot as ce}from"https://esm.sh/react-dom/client";import B,{useEffect as le,useRef as je,useState as Te}from"https://esm.sh/react";import{unstableSetRender as _e,theme as Pe,Input as Oe,Typography as L,notification as Re,Flex as P,ConfigProvider as Ue,Tooltip as re,Radio as N,Checkbox as se,Table as Ce,Spin as De,Tag as H,Button as q,Alert as ze}from"https://esm.sh/antd?standalone";import{GithubOutlined as We,YoutubeOutlined as Ee,TwitterOutlined as Me,SunOutlined as Ae,MoonOutlined as Be,DownloadOutlined as Z}from"https://esm.sh/@ant-design/icons?standalone";import Ne from"https://esm.sh/fuse.js?standalone";import{File as M,encode as G,Fmt as X,decode as W,guess as E}from"https://esm.sh/@easy-install/easy-archive?standalone";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const He="ttf,otf,woff,woff2,eot".split(",");function qe(n,e){if(!n?.length)return!1;for(const t of e){if(t.length===0)return!n.includes(".");if(n.endsWith(`.${t}`))return!0}return!1}function Y(n,e=He){return qe(n.toLocaleLowerCase(),e)}function Je(n,e,t){const c=new TextDecoder("utf-8"),i=c.decode(n),r="#".repeat(4),o=[r,t.name,r].join(" ");if(i.includes(o))return n;const a=c.decode(e).trim(),p=[i,"",o,a,o,""].join(`
`).trimStart();return new TextEncoder().encode(p)}function Ke(n){if(n.length===0)return 0;if(n.length===1)return n[0].length;let e=0;const t=n[0];for(let c=0;c<t.length;c++){const i=t[c];if(n.every(r=>r[c]===i))e++;else break}return e}function ae(n,e,t,c="portable_config"){for(const o of["fonts","script-opts","shaders"])if(e.find(a=>a.path.startsWith(`${o}/`))){const a=e.filter(p=>p.path.startsWith(`${o}/`));e=e.filter(p=>!p.path.startsWith(`${o}/`));for(const p of a)p.path=`${c}/${o}/${p.path.replace(`${o}/`,"")}`,n.push(p)}if(e.find(o=>o.path.startsWith("scripts/"))){const o=e.filter(d=>d.path.startsWith("scripts/"));e=e.filter(d=>!d.path.startsWith("scripts/"));const a=o.map(d=>d.path.split("/")).map(d=>d.slice(1,d.length-1)),p=Ke(a),g=`${(p?["scripts",...a[0].slice(0,p)]:["scripts"]).join("/")}/`,w=o.filter(d=>!d.path.replace(g,"").includes("/")&&d.path.endsWith(".lua")),b=o.filter(d=>!d.path.replace(g,"").includes("/")&&d.path.endsWith(".js"));w.length===1?w[0].path=`${t.scriptName||t.name}/main.lua`:b.length===1&&(b[0].path=`${t.scriptName||t.name}/main.js`);for(const d of o){const k=d.path.replace(g,`${t.scriptName||t.name}/`);d.path=`${c}/scripts/${k}`,n.push(d)}}if(e.find(o=>o.path.startsWith("externals/"))){const o=e.filter(a=>a.path.startsWith("externals/"));e=e.filter(a=>!a.path.startsWith("externals/"));for(const a of o)a.path=a.path.replace("externals/",""),n.push(a)}for(const o of["input.conf","mpv.conf"]){const a=e.findIndex(x=>x.path===o);if(a===-1)continue;const p=e.splice(a,1)[0],m=n.findIndex(x=>x.path===`${c}/${o}`);let g;m===-1?g=new M(`${c}/${o}`,new Uint8Array,void 0,!1,BigInt(Date.now())):g=n.splice(m,1)[0];const{path:w,mode:b,isDir:d,lastModified:k,buffer:h}=g,j=Je(h,p.buffer,t);n.push(new M(w,j,b,d,k))}if(e.find(o=>!o.path.includes("/")&&o.path.endsWith(".conf"))){const o=e.filter(a=>!a.path.includes("/")&&a.path.endsWith(".conf"));e=e.filter(a=>!(!a.path.includes("/")&&a.path.endsWith(".conf")));for(const a of o){const p=e.find(w=>w.path===a.path.replace(".conf",".js")),m=e.find(w=>w.path===a.path.replace(".conf",".lua")),g=p||m?`${c}/script-opts/${a.path}`:a.path;a.path=g,n.push(a)}}if(e.find(o=>!o.path.includes("/")&&Y(o.path))){const o=e.filter(a=>!a.path.includes("/")&&Y(a.path));e=e.filter(a=>!(!a.path.includes("/")&&Y(a.path)));for(const a of o)a.path=`${c}/fonts/${a.path}`,n.push(a)}const i=e.filter(o=>!o.path.includes("/")&&o.path.endsWith(".lua")),r=e.filter(o=>!o.path.includes("/")&&o.path.endsWith(".js"));i.length===1?i[0].path="main.lua":r.length===1&&(r[0].path="main.js");for(const o of e)o.path=`${c}/scripts/${t.scriptName||t.name}/${o.path}`,n.push(o)}const Ze=[["thumbfast","mpv-easy-thumbfast"],["autoload","mpv-easy-autoload"],["uosc","mpv-easy","ModernX cyl0","ModernZ","mpv.net"]],ue={uosc:["autoload","mpv-easy-autoload"],"mpv-easy":["mpv-easy-anime4k","mpv-easy-clipboard-play","mpv-easy-copy-time","mpv-easy-cut","mpv-easy-translate","mpv-easy-autoload","mpv-easy-copy-screen","mpv-easy-crop","mpv-easy-thumbfast"]};function Ge(n,e=Ze){for(const i of e){const r=[];for(const o of n)i.includes(o)&&r.push(o);if(r.length>1)return r}const t=new Set,c=new Set(n);for(const i in n){const r=ue[i]||[];for(const o of r)c.has(o)&&(t.add(i),t.add(o))}return Array.from(t)}var Xe=function(n){le(n,[])},Ye=function(n){Xe(function(){n()})};const ie=n=>{let e;const t=new Set,c=(m,g)=>{const w=typeof m=="function"?m(e):m;if(!Object.is(w,e)){const b=e;e=g??(typeof w!="object"||w===null)?w:Object.assign({},e,w),t.forEach(d=>d(e,b))}},i=()=>e,a={setState:c,getState:i,getInitialState:()=>p,subscribe:m=>(t.add(m),()=>t.delete(m))},p=e=n(c,i,a);return a},Qe=n=>n?ie(n):ie,Ve=n=>n;function Fe(n,e=Ve){const t=B.useSyncExternalStore(n.subscribe,B.useCallback(()=>e(n.getState()),[n,e]),B.useCallback(()=>e(n.getInitialState()),[n,e]));return B.useDebugValue(t),t}const et=n=>{const e=Qe(n),t=c=>Fe(e,c);return Object.assign(t,e),t},tt=n=>et;function fe(n,e){let t;try{t=n()}catch{return}return{getItem:i=>{var r;const o=p=>p===null?null:JSON.parse(p,void 0),a=(r=t.getItem(i))!=null?r:null;return a instanceof Promise?a.then(o):o(a)},setItem:(i,r)=>t.setItem(i,JSON.stringify(r,void 0)),removeItem:i=>t.removeItem(i)}}const F=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(c){return F(c)(t)},catch(c){return this}}}catch(t){return{then(c){return this},catch(c){return F(c)(t)}}}},nt=(n,e)=>(t,c,i)=>{let r={storage:fe(()=>localStorage),partialize:h=>h,version:0,merge:(h,j)=>({...j,...h}),...e},o=!1;const a=new Set,p=new Set;let m=r.storage;if(!m)return n((...h)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),t(...h)},c,i);const g=()=>{const h=r.partialize({...c()});return m.setItem(r.name,{state:h,version:r.version})},w=i.setState;i.setState=(h,j)=>{w(h,j),g()};const b=n((...h)=>{t(...h),g()},c,i);i.getInitialState=()=>b;let d;const k=()=>{var h,j;if(!m)return;o=!1,a.forEach(S=>{var I;return S((I=c())!=null?I:b)});const x=((j=r.onRehydrateStorage)==null?void 0:j.call(r,(h=c())!=null?h:b))||void 0;return F(m.getItem.bind(m))(r.name).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==r.version){if(r.migrate){const I=r.migrate(S.state,S.version);return I instanceof Promise?I.then(R=>[!0,R]):[!0,I]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,S.state];return[!1,void 0]}).then(S=>{var I;const[R,A]=S;if(d=r.merge(A,(I=c())!=null?I:b),t(d,!0),R)return g()}).then(()=>{x?.(d,void 0),d=c(),o=!0,p.forEach(S=>S(d))}).catch(S=>{x?.(void 0,S)})};return i.persist={setOptions:h=>{r={...r,...h},h.storage&&(m=h.storage)},clearStorage:()=>{m?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>k(),hasHydrated:()=>o,onHydrate:h=>(a.add(h),()=>{a.delete(h)}),onFinishHydration:h=>(p.add(h),()=>{p.delete(h)})},r.skipHydration||k(),d||b},ot=nt;function rt(n){try{const e=new URL(n);if(e.hostname!=="github.com")return;const t=e.pathname.split("/").filter(Boolean);return t.length<2?void 0:{user:t[0],repo:t[1]}}catch{return}}_e(function(n,e){e._reactRoot||(e._reactRoot=ce(e));var t=e._reactRoot;return t.render(n),function(){return new Promise(function(c){setTimeout(function(){t.unmount(),c()},0)})}});const de="https://cdn.jsdelivr.net";async function st(n){const e=await fetch(n).then(t=>t.arrayBuffer());return new Uint8Array(e)}async function at(n){const e=it(n);if(!e)return[];const t=/<a[^>]+href="([^"]+)"[^>]*>([^<]+)<\/a>/g,c=[];for(const i of Array.from(e.matchAll(t),([,r,o])=>{const a=r.endsWith("/");return{path:r.split("/").slice(4).join("/"),url:de+r,name:o,isDir:a}}))i.isDir||(i.buffer=await st(i.url)),i.name!=="..."&&c.push(i);return c}function it(n){const e=/<table[^>]*>([\s\S]*?)<\/table>/i,t=n.match(e);return t?t[1].trim():null}async function pe(n,e,t){const c=await fetch(t).then(o=>o.text()),i=await at(c),r=[];for(const o of i)if(o.isDir){const a=t+o.path,p=await pe(n,e,a);for(const m of p)r.push(m)}else r.push(o);return r}function ee(n,e){const t=de+`/gh/${n}/${e}/`;return pe(n,e,t)}const{defaultAlgorithm:ct,darkAlgorithm:lt}=Pe,{Search:ut}=Oe,{Title:ft,Link:dt}=L,pt={getItem:n=>{const t=new URLSearchParams(location.hash.slice(1)).get(n)??"";return JSON.parse(t)},setItem:(n,e)=>{const t=new URLSearchParams(location.hash.slice(1));t.set(n,JSON.stringify(e)),location.hash=t.toString()},removeItem:n=>{const e=new URLSearchParams(location.hash.slice(1));e.delete(n),location.hash=e.toString()}},ht=["mpv","mpv-v3","mpv.net"],he={data:{},tableData:[],spinning:!1,selectedRowKeys:[],externalList:[],ui:"osc",platform:"mpv-v3",repos:[]},mt=tt()(ot((n,e)=>({...he,setData:t=>n({...e(),data:t}),setTableData:t=>n({...e(),tableData:t}),setSpinning:t=>n({...e(),spinning:t}),setSelectedKeys:t=>n({...e(),selectedRowKeys:t}),setExternalList:t=>n({...e(),externalList:t}),setUI:t=>n({...e(),ui:t}),setPlatform:t=>n({...e(),platform:t}),setState:t=>{n({...e(),...t})},setRepos:t=>n({...e(),repos:t})}),{name:"mpv-build",storage:fe(()=>pt),version:void 0,partialize:n=>Object.fromEntries(Object.entries(n).filter(([e])=>!["data","tableData","spinning"].includes(e)))})),Q=150,V=150,yt=250;function J(n,e){const t=new Blob([new Uint8Array(e)],{type:"application/octet-stream"}),c=URL.createObjectURL(t),i=document.createElement("a"),r=n.split("/").at(-1)??n;i.download=r,i.href=c,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(c)}function gt(n,e,t,c){return`https://raw.githubusercontent.com/${n}/${e}/${t}/${c}`}function O(n){return gt("ahaoboy","mpv-easy-cdn","main",n)}function vt(){return O("mpv-easy-play-with-windows.zip")}function wt(){return O("yt-dlp.zip")}function bt(){return O("ffmpeg-windows.tar.xz")}function St(){return O("ffmpeg-v3-windows.tar.xz")}const z=[{name:"osc",repo:"https://github.com/mpv-player/mpv",deps:["autoload","thumbfast"],requires:[]},{name:"uosc",repo:"https://github.com/tomasklaen/uosc",deps:["thumbfast"],requires:["uosc"]},{name:"mpv-easy",repo:"https://github.com/mpv-easy/mpv-easy",deps:[],requires:["mpv-easy"]},{name:"modernx",repo:"https://github.com/cyl0/ModernX",deps:["thumbfast","autoload"],requires:["ModernX cyl0"]},{name:"modernz",repo:"https://github.com/Samillion/ModernZ",deps:["thumbfast","autoload"],requires:["ModernZ"]}],$t=["ffmpeg","yt-dlp","play-with"];async function C(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>new Uint8Array(e))}function me(n){return O(`${n}.zip`)}async function kt(n){if(n.repo)return(await ee(n.repo.user,n.repo.repo)).filter(o=>!o.isDir).map(({path:o,buffer:a})=>new M(o,a,void 0,!1,null));const{download:e}=n;if(![".js",".lua",".zip"].some(r=>e.endsWith(r)))return console.log("not support script: ",n),[];const t=me(n.name),c=await C(t);return W(E(t),c).filter(r=>!r.isDir)}async function xt(n,e){let t=O("mpv-windows.tar.xz");n==="mpv.net"&&(t=O("mpv.net.tar.xz"));const c=await C(t);return W(E(t),c)||[]}function It(){const n=mt(),e=je(null),{data:t,tableData:c,spinning:i,selectedRowKeys:r,externalList:o,ui:a,setData:p,setTableData:m,setSpinning:g,setUI:w,setSelectedKeys:b,setExternalList:d,platform:k,setPlatform:h,setState:j,repos:x,setRepos:S}=n,I=a==="mpv-easy"?"mpv-easy":`mpv-${a}`,[R,A]=Te(window.matchMedia("(prefers-color-scheme: dark)").matches),K=z.find(s=>s.name===a)?.requires||[],[Lt,ye]=Re.useNotification(),ge=()=>{j({...he,data:t,tableData:c})},ve=[...r,...z.find(s=>s.name===a)?.requires||[]],te=async s=>{for(const l of ve){const y=t[l];if(y.repo){const{user:v,repo:f}=y.repo,T=(await ee(v,f)).filter(D=>!D.isDir).map(({path:D,buffer:Le})=>new M(D,Le,void 0,!1,null)),U=`${v}-${f}`;ae(s,T,t[U])}else{const v=await kt(t[l]);ae(s,v,t[l])}}},we=async()=>{const s=[];await te(s);for(const y of s)y.path=y.path.replace("portable_config/","");const l=G(X.Zip,s);if(!l){console.log("zip file error");return}return l},be=async()=>{const s=await xt(k);if(o.includes("ffmpeg")){const y=k==="mpv-v3"?St():bt(),v=await C(y),f=W(E(y),v);for(const $ of f)s.push($)}if(o.includes("yt-dlp")){const y=wt(),v=await C(y),f=W(E(y),v);for(const $ of f)s.push($)}if(o.includes("play-with")){const y=vt(),v=await C(y),f=W(E(y),v);for(const $ of f)s.push($)}await te(s);const l=G(X.Zip,s);if(!l){console.log("zip file error");return}return l},Se=async()=>{g(!0),await new Promise(l=>setTimeout(l));const s=await be();g(!1),s&&J(`${I}.zip`,s)},$e=async()=>{g(!0),await new Promise(l=>setTimeout(l));const s=await we();g(!1),s&&J("portable_config.zip",s)},ne=async()=>{const s=O("scripts-full.json"),l=await fetch(s).then(f=>f.text()).then(f=>JSON.parse(f));for(const f in l)l[f].key=f;for(const{user:f,repo:$}of x){const T=`${f}-${$}`,U=`https://github.com/${f}/${$}`,D={key:T,name:T,download:T,author:f,description:U,homepage:U,repo:{user:f,repo:$}};l[T]=D}p(l);const y=r.map(f=>l[f]),v=Object.values(l).sort(()=>.5-Math.random()).filter(f=>!r.includes(f.name));m([...y,...v]),e.current=new Ne(Object.values(l),{keys:["name"]})};Ye(ne),le(()=>{ne()},[x]);const ke=[{title:"name",dataIndex:"name",key:"key",render:(s,l)=>u(dt,{href:l.homepage,target:"_blank",rel:"noreferrer",children:l.name}),width:yt},{title:"description",dataIndex:"description",key:"key"},{title:"author",dataIndex:"author",key:"url"},{title:"download",dataIndex:"download",key:"url",render:(s,l)=>u(q,{icon:u(Z,{}),onClick:async()=>{if(l.repo){const f=(await ee(l.repo.user,l.repo.repo)).filter(T=>!T.isDir).map(({path:T,buffer:U})=>new M(T,U,void 0,!1,null)),$=G(X.Zip,f);$&&J(`${l.repo.repo}.zip`,$);return}const y=await C(me(l.name));J(`${l.name}.zip`,y)}},l.download)}],xe=(s,l,y)=>{const v=rt(s);if(v){b([...new Set([...r,`${v.user}-${v.repo}`])]),S([...new Set([...x,v])]);return}const f=e.current?.search(s);f?.length&&m(f.map($=>$.item))};if(!Object.keys(t).length)return u(P,{className:"main",vertical:!0,gap:"middle",justify:"center",align:"center",children:u(L,{children:u(ft,{level:3,children:"Loading..."})})});const oe=Ge([...r,...z.find(s=>s.name===a)?.requires||[]]),Ie=ue[a]||[];return _(Ue,{theme:{algorithm:R?lt:ct},children:[ye,_(P,{className:["main",R?"main-dark":"main-light"].join(" "),vertical:!0,gap:"middle",justify:"center",align:"center",children:[_(P,{gap:"middle",justify:"center",align:"center",style:{position:"absolute",top:"1rem",right:"1rem"},children:[u(L.Link,{href:"https://github.com/mpv-easy/mpv-easy",target:"_blank",children:u(We,{})}),u(L.Link,{href:"https://www.youtube.com/@mpveasy",target:"_blank",children:u(Ee,{})}),u(L.Link,{href:"https://x.com/mpv_easy",target:"_blank",children:u(Me,{})}),R?u(L.Link,{onClick:()=>A(!1),children:u(Ae,{})}):u(L.Link,{onClick:()=>A(!0),children:u(Be,{})})]}),_(P,{gap:"middle",vertical:!0,align:"start",children:[_(P,{gap:"middle",justify:"center",align:"center",children:[u(L.Title,{level:5,style:{margin:0,width:Q},children:u(re,{title:"mpv-v3 is for newer CPUs (usually after 2005). If it doesn't run, please use mpv",children:"Platform:"})}),u(N.Group,{value:k,onChange:s=>{h(s.target.value)},children:ht.map(s=>u(re,{placement:"topLeft",title:s==="mpv"?"Typically, you should use mpv-v3 unless it fails to run or you're using an older CPU (manufactured around 2015 or earlier).":"",children:u(N,{value:s,style:{width:V},children:s},s)},s))})]}),_(P,{gap:"middle",justify:"center",align:"center",children:[u(L.Title,{level:5,style:{margin:0,width:Q},children:"UI:"}),u(N.Group,{onChange:s=>{w(s.target.value);const l=z.find(y=>y.name===s.target.value)?.deps||[];b([...l])},value:a,children:z.map(s=>u(N,{value:s.name,style:{width:V},children:u(L.Link,{href:s.repo,target:"_blank",children:s.name})},s.name))})]}),_(P,{gap:"middle",justify:"center",align:"center",children:[u(L.Title,{level:5,style:{margin:0,width:Q},children:"External:"}),u(se.Group,{value:o,onChange:s=>{d(s)},children:$t.map(s=>u(se,{value:s,style:{width:V},children:s},s))})]})]}),u(ut,{placeholder:"input script name or https://github.com/<user>/<repo>",onSearch:xe,enterButton:!0}),u(Ce,{rowSelection:{hideSelectAll:!0,type:"checkbox",onSelect:(s,l)=>{b(l?[...r,s.name]:[...r].filter(y=>y!==s.name))},getCheckboxProps:s=>({disabled:K.includes(s.name)||Ie.includes(s.name),name:s.name}),selectedRowKeys:[...r,...K]},className:"table",columns:ke,dataSource:c}),u(De,{spinning:i,fullscreen:!0}),_(P,{children:[u(H,{color:"processing",children:k},k),K.map((s,l)=>t[s]&&u(H,{color:"success",children:t[s]?.name},t[s]?.key+l)),o.map(s=>u(H,{color:"success",children:s},s)),r.map((s,l)=>u(H,{closable:!0,color:"success",onClose:y=>{const v=r.indexOf(t[s]?.key);if(v!==-1){const f=[...r];f.splice(v,1),b(f)}y.preventDefault()},children:t[s]?.name},t[s]?.key+l))]}),_(P,{gap:"middle",children:[u(q,{color:"danger",size:"large",variant:"solid",onClick:ge,children:"Reset"}),_(q,{type:"primary",icon:u(Z,{}),size:"large",onClick:Se,children:[I,".zip"]}),u(q,{type:"primary",icon:u(Z,{}),size:"large",onClick:$e,children:"portable_config.zip"})]}),!!oe.length&&u(ze,{description:`conflict: ${oe.join(" ")}`,type:"error"})]})]})}ce(document.getElementById("root")).render(u(It,{}));
